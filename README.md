# Wheeled-Combat-Robot

## 1 总体方案设计：

### 1.1车体结构的总体设计

车体结构经过重新设计，根据传感器的位置，上台所需要的机械结构进行初步规划，再着重思考了前方铲子的设计规划，以确保极具攻击力，增加攻击力的同时也增加了生存的可能。后续在轮胎上也多加思考，选取制作了摩擦力极高的轮胎。在中心结构上也多有思考与改进。

重量：应尽可能接近比赛要求极限，只有重量越重，给机器人轮子提供的正压力才能越大，根据f =uF，则知对擂台的摩擦越 大，才能有效防止己方被推下擂台。

尺寸：尺寸大小也应当尽量接近比赛限制，只有通过长宽的最大极限来降低机器人的整体重心，才可以使机器人在擂台上更好地稳定行走，减少由于惯性引起的失误。

### 1.2 整体车模

整车模型重新设计，如图1-1，图1-2是通过SolidWorks完成的3D模型。

![](https://github.com/HKUSTGZPray/Wheeled-Combat-Robot/blob/master/images/757a630a2b6e1a13d26fd7a47ebf87c7.png)

<div align = "center">图1-1 3D模型图</div>

![](https://github.com/HKUSTGZPray/Wheeled-Combat-Robot/blob/master/images/b43715ff563e2fa4dde3c1841b5ed442.png)

<div align = "center">图1-2 SolidWork侧视图</div>

如图1-3为机器人实物图

![](https://github.com/HKUSTGZPray/Wheeled-Combat-Robot/blob/master/images/b67a9e9d3103c1948e74023655e2f29e.jpeg)

<div align = "center">图1-3 实物图</div>

### 1.3 主要模块以及算法实现思路

车身模块分为：台上台下定位模块；防掉台模块；攻击模块以及供电模块。定时器与主循环各分其职，以高响应，低延时完成动作。定时器负责通过所有传感器数值的更新，然后通过该数值来进行所有情况的判断，更新相应的标志位。主循环函数负责通过相应的标志位来完成相应的机动。

## 2 车身机械结构调整与优化

### 2.1 车头结构

如图2-1所示，本车对车头处进行了较大部分的更改，灵感来自于机器铲车，其不仅有良好的抗撞击能力，同时拥有强大的功能性，相比于传统车头，本车头设计有以下特点：

1. 车头自然下垂时低于底盘，保证与在场地行进时铲子与地面契合，防止被对手铲子铲起。

2. 车头中部采用部分齿形结构，提高了车辆底部摩擦，保证将对手车辆铲起后对其进行减速处理。

3. 中部分四边的突起，能够将对方车辆前轮架空，降低对方抓地能力，进而将其推入台下。

4. 车头上方与最上处突出倒刺结合，避免出现对方车辆越过铲子的情况。同时也增加了一定的美观性。

![](https://github.com/HKUSTGZPray/Wheeled-Combat-Robot/blob/master/images/3b89fca007a11e506fd5e4f81e399a8e.jpeg)

<div align = "center">图2-1 车头设计</div>

### 2.2 车身结构

车体材料整体采用PVC3D打印材质，拥有较大的稳定性与牢固性。同时四处红外对管实现90°调节，前后左右四处红外测距能实现上下前后移动，传感器整体能够满足多方向调试，便于调试修改。上下板支撑结构为四个方向，使得其受力面积更为稳定。

在设计过程中采用标准件方法设计机器人，使整车由多个标准组件拼装而成，有利于比赛中车辆损坏的快速替换，而且便于制造装配、采购和更好的扩展性。

本车采用四驱轮移动机构，每个驱动轮独立驱动，同时轮胎采用双驼峰橡胶轮胎，可以产生较大的驱动力。

对于主控、驱动、电源的位置放置，采取重心偏后原则，在不产生干涉的情况下将部件放置于车头偏后侧，重心后移，便于上台。本车上台方式采取后方倒退上台，对重心位置有较高的要求，因此将较多部件放置于后侧，便于上台。

### 2.3 上台问题解决及优化

因为新的比赛规则去除了坡道的设置，所以机器人要想登上 60cm高的擂台，必须要对机器人的结构进行重新设计，为登台设计专门的机构，实现机器人的自主登台。根据对比赛场地的分析，登上 60mm 高的擂台方式有如下几种:

1. 直接登台式：可以使用半径大于 60mm 的车轮或者使用履带结构，这样机器人可以直接走上擂台。这种方式的优点是上台很迅速。缺点是提高了机器人的重心，在比赛当中容易被对方推下台，进攻上灵活性较低。

2. 攀爬式：可以利用攀爬机构，使机器人爬上擂台，例如使用舵机，在机器人的前后各安装 2 个 舵 机，利用舵机转动一定的角度，驱动爪子，构成攀爬结构使擂台机器人爬上擂台。这种方式的优点是不改变机器人的驱动结构，进攻灵活、重心低防御力强。缺点是需要安装四个舵机，而机器人的大小是有限制的，四个舵机会很占用机器人的空间，并且舵机的增加，又使得机器人出现故障的几率增加，上台速度较慢。

对比上述两种登台方式各自的优缺点和实际实验，我们设计出一种新的上台装置，上台装置为两个倒三角形斜披，安装在机器人的尾部，与车身下层底盘的角度为 120°-140°之间，如图2-2所示。

![](https://github.com/HKUSTGZPray/Wheeled-Combat-Robot/blob/master/images/bdd2811bf8cd756ac7be2a5195d75d92.jpeg)

<div align = "center">图2-2 上台装置</div>

### 2.4 传感器选择与位置摆放

为实现防止掉台的功能，我们选择了四个红外对管放在左前、右前、左后和右后的位置，在快触碰到擂台的边缘时可以及时反映，传回信号。

为稳定精准的在台下定位成功，在传感器分布策略上进行了高于擂台和低于擂台的区分，在车身的前侧与后侧均在高于擂台处出配有红外测距传感器，同时在低于擂台处配备了红外对管数字量传感器。在左侧低于擂台处配有三个红外测距传感器，分别用来检测左前方，正左侧，和左后方，尽最大可能去涵盖左侧区域，减少死角。

同理在右方低于擂台处进行相同的配置。在高于擂台处，左侧和右侧也分别配备了一个红外测距模块。同时在左前方、右前方、左后方和右后方都装配了一个红外对管，用来进行稳定的台上边缘检测。此种传感器配方法可以实现对于每一个情况做出相应的判断和相应的行动。多时段调节，复杂情况调节。

## 3 车体控制软件及算法

如图3-1所示，这是车体算法流程图。

![](https://github.com/HKUSTGZPray/Wheeled-Combat-Robot/blob/master/images/%E6%88%AA%E5%B1%8F2024-06-07%2015.06.59.jpg)

<div align = "center">图3-1 算法流程图</div>

### 3.1 自身位置确定

自身位置确定是让车体自身时时刻刻知道自己所在台上还是台下。为提高传感器的使用效率，通过完成车体自身位置确定可以让传感器在台上台下负责不同的功能。在传感器选择方面，我们使用车体上高度低于6cm下的前后红外对管，与左侧和右侧各三个的红外测距，以及高于6cm放于前后左右的四个红外测距来共同作用来实现该功能。

基本逻辑为在台上时，不可能存在左右或者前后同时有障碍物的情况，通过传感器返回的数值，在一定范围内当该情况发生时可以判定为在台下（在擂台和墙壁之间）并且不可能同时出现左前或右后这样相邻两遍同时出现敌方目标的情况，这时可以判定为在台下（在角落上）。

### 3.2 定时器设定

在控制上，为稳定而精确的进行传感器数据更新和自身状态获取，我们加入了定时器来参与数据更新和情况判断。定时器的任务为判断车身情况并进行相应情况标志位的更新，核心程序再进行情况处理。具体检测了检测台上台下、检测边缘、在台下检测朝向、检测敌人的具体位置、调整车身对准敌人等

### 3.3 台上设计思路

应用基础标准组件的函数封装，自己另设代码函数。整体框架源于车模状况的实时监测。将策略进行了模块化的细分：台上边缘检测、漫游寻敌、锁定攻击、台下自身位置状态检测等众多模块。再通过定时器进行稳定的车体自身状态检测，从而达到反应灵敏和可以应对众多突发情况。

核心的思路为：力争掌握战斗的主动权，最好的防御就是进攻

通过左右两边分别的三个传感器来确定位于车辆周边30度到150度的敌方车辆，车身控制电机转向来使车辆对准地方车辆，再通过车辆前方的测距传感器确保车辆正对准目标，再加速至最大速度冲击敌车，将其撞下台。并且在敌车企图上台的时候，将其继续设为攻击状态，稳定胜局。

为在刚寻找到目标时抢先敌方车辆行动，加快车辆响应占据战斗的主动权，我们选择在锁定之后就以满速进攻。

为了加快电机响应速度，我们在电机函数中，加入了增量式PID，其中，由于电机为开环控制，于是我们将err设置为了上一次的理论值加上其偏差量。实际调试中发现响应速度显著加快。同时，通过定时器中断稳定检测车辆在台上的情况，以防止因为冲击敌方而导致我方车辆下台的自杀性攻击。

由于测距模块的局限性，我们限定了其搜索范围，出现一定几率的未找到敌方的状态。此时，我们进行设计了巡游状态进行弥补与防御，车辆以较低的速度开始按照我们设计的路线漫游，来确保搜索敌方的同时不漏出自己的弱点，等待发现目标再进行攻击。为在发现敌方后能精准将车头对准敌方车辆的方向，加快相应，我们对其进行了大量的代码调节与参数修改。

### 3.4 台下设计思路

初始检测上台：初始时通过前方的红外测距来检测手势信号，当测得的距离小于我们的设定值时进行首发车。在执行此程序后实时状态检测也会开始执行。

因为车体自身重量较大，需要靠惯性的加持下才能上台，所以我们在台下运动函数中，当在判断离擂台太近时会先远离擂台一段的距离，确保可以上台成功。同时，在旋转之前调整车体的位置是至关重要的，如果离擂台或墙体边缘太近时会被卡住，造成死机，增加在台下的时间。所以车体在台下旋转调整车头朝向时，我们会让车体结合传感器的总和判断先进行前后机动，来确保正常的旋转。此外要注意在场地的四个角落要进行单独处理，通过传感器的判定直接或旋转后先跑到在擂台和墙壁之间，将特殊状态变为普通状态，再进行相应的操作。在调整好位置和离台距离后执行上台程序。

### 3.5算法思路改进

1. 在原有的delay算法中，delay时无法进行实时检测，此时车身属于无法反应阶段，频繁的使用delay会导致传感器检测慢，车身控制反应迟钝，所以将其改为了实时监测的算法，尽最大可能使车身一直处于检测与可机动状态。同时新增加刹车优化算法与自生定位算法等等，使得车辆进一步的稳定。另外添加多种情况的处理，强化在随机情况下的反应能力，加强稳定鲁棒性。
2. 在红外模拟量测距传感器上，问题也十分突出。首先它的有效测量距离要求较为苛刻，在大于8cm后有较为准确的测量数值，但是一旦少于8cm，它会失效，数值不可信。如图3-2所示在一定距离中一个模拟量的数值可能代表了两个距离，这样的误差给逻辑判断增加了不小的难度，尤其是在台下时，为了不影响车体自身判断，只能对算法做出相应的改变，例如将红外测距当做数字量红外对管来用，当大于某一设定值时为1小于为0。同时，该值误差较大，经测量浮动大致在-40到+40之间，对使用者很不友好，在某些需要传感器精度的情况下，我们对测距的值进行卡尔曼滤波处理，来提高一定的精度。

![](https://github.com/HKUSTGZPray/Wheeled-Combat-Robot/blob/master/images/7ed8d8ba4e836d2c62f20460dd2e191f.png)

<div align = "center">图3-2 测距传感器</div>

3. 斜着在擂台上的问题。在被攻击后，有可能没有完全被铲下去，而是斜着在擂台上。此种情况十分危险，不可不考虑。
4. 加入了PID算法，增强了稳定性与转弯时的高响应

